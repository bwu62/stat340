[{"name":"app.R","content":"library(shiny)\r\n\r\nui = fluidPage(\r\n  titlePanel(\"Pima logistic\"),\r\n  sidebarLayout(\r\n    sidebarPanel(\r\n      radioButtons(\"model\",\"Which model\",c(\"Null\"=\"null\",\"Glu\"=\"glu\",\"All\"=\"all\")),\r\n      sliderInput(\"threshold\",\"Prediction threshold\",0,1,.5,.01),\r\n      verbatimTextOutput(\"confusionMatrix\"),\r\n      verbatimTextOutput(\"statistics\")\r\n    ),\r\n    mainPanel(plotOutput(\"rocPlot\"))\r\n  )\r\n)\r\n\r\nserver = function(input, output) {\r\n  \r\n  library(MASS)\r\n  library(tidyverse)\r\n  library(pROC)\r\n  library(glue)\r\n  \r\n  if(is.factor(Pima.te$type)) Pima.te$type = ifelse(Pima.te$type=='Yes',1,0)\r\n  model = list(null=glm(type~1, data=Pima.te, family=\"binomial\"),\r\n               glu=glm(type~glu, data=Pima.te, family=\"binomial\"),\r\n               all=glm(type~., data=Pima.te, family=\"binomial\"))\r\n  \r\n  observeEvent(c(input$threshold,input$model),{\r\n    conf.tab = table(\r\n      Pima.te$type,\r\n      factor(predict.glm(model[[input$model]], type=\"response\") >= input$threshold, levels=c(F,T)))\r\n    colnames(conf.tab) = c(\"Predict 0\",\"Predict 1\")\r\n    rownames(conf.tab) = c(\"No diabetes\",\"Yes diabetes\")\r\n    \r\n    output$confusionMatrix = renderPrint({\r\n      conf.tab\r\n    })\r\n    \r\n    output$statistics = renderPrint({\r\n      TP = conf.tab[2,2]\r\n      TN = conf.tab[1,1]\r\n      FP = conf.tab[1,2]\r\n      FN = conf.tab[2,1]\r\n      cat(\"      Accuracy:\",round((TP+TN)/(TP+TN+FP+FN),3))\r\n      cat(\"\\n   Sensitivity:\",round(TP/(TP+FN),3))\r\n      cat(\"\\n   Specificity:\",round(TN/(TN+FP),3))\r\n      cat(\"\\nPrecision(PPV):\",round(TP/(TP+FP),3))\r\n      cat(\"\\n           NPV:\", round(TN/(TN+FN),3))\r\n    })\r\n    \r\n    output$rocPlot = renderPlot({\r\n      predictions = predict(model[[input$model]], newdata=Pima.te, type=\"response\")\r\n      pt = data.frame(x=(conf.tab[1,2]/sum(conf.tab[1,])),y=(conf.tab[2,2]/sum(conf.tab[2,])))\r\n      roc(Pima.te$type~predictions) %>%\r\n        ggroc(legacy.axes=T) + \r\n          labs(title=\"ROC curve\",subtitle=glue(\"AUC: {round(test_roc$auc,3)}\"),\r\n               x=\"False positive rate\",y=\"True positive rate\") + \r\n          scale_x_continuous(expand=c(0,0)) + scale_y_continuous(expand=c(0,0)) + \r\n          geom_point(data=pt, aes(x=x, y=y), col=\"red\",size=5) + \r\n          geom_abline() + coord_equal()\r\n    })\r\n    \r\n  })\r\n  \r\n}\r\n\r\nshinyApp(ui = ui, server = server)\r\n","type":"text"}]
